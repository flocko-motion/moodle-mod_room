{"version":3,"sources":["../src/date_reload.js"],"names":["define","LoadingIcon","Ajax","Notification","selectorDay","document","getElementById","selectorMonth","selectorYear","roomPlanContainer","displayingDate","cmId","datesEqual","date1","date2","day","month","year","selectedDate","Math","floor","value","reloadRoomPlanIfDateChanged","iWillLoad","innerHTML","loadingicon","addIconToContainerWithPromise","request","methodname","args","date","cmid","call","then","response","resolve","html","history","pushState","url","fail","exception","init","initialDate","style","display","setInterval"],"mappings":"AA2BAA,OAAM,wBAAC,CACH,kBADG,CAEH,WAFG,CAGH,mBAHG,CAAD,CAIH,SACCC,CADD,CAECC,CAFD,CAGCC,CAHD,CAID,IAOQC,CAAAA,CAAW,CAAGC,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,CAPtB,CAQQC,CAAa,CAAGF,QAAQ,CAACC,cAAT,CAAwB,sBAAxB,CARxB,CASQE,CAAY,CAAGH,QAAQ,CAACC,cAAT,CAAwB,qBAAxB,CATvB,CAWQG,CAAiB,CAAGJ,QAAQ,CAACC,cAAT,CAAwB,oBAAxB,CAX5B,CAqBMI,CArBN,CAsBMC,CAtBN,CAwBQC,CAAU,CAAG,SAASC,CAAT,CAAgBC,CAAhB,CAAuB,CACtC,MAAOD,CAAAA,CAAK,CAACE,GAAN,GAAcD,CAAK,CAACC,GAApB,EAA2BF,CAAK,CAACG,KAAN,GAAgBF,CAAK,CAACE,KAAjD,EAA0DH,CAAK,CAACI,IAAN,GAAeH,CAAK,CAACG,IACzF,CA1BH,CA4BQC,CAAY,CAAG,UAAW,CAC5B,MAAO,CACHH,GAAG,CAAEI,IAAI,CAACC,KAAL,CAAWhB,CAAW,CAACiB,KAAvB,CADF,CAEHL,KAAK,CAAEG,IAAI,CAACC,KAAL,CAAWb,CAAa,CAACc,KAAzB,CAFJ,CAGHJ,IAAI,CAAEE,IAAI,CAACC,KAAL,CAAWZ,CAAY,CAACa,KAAxB,CAHH,CAKV,CAlCH,CAoCQC,CAA2B,CAAG,UAAW,CAC3C,GAAIV,CAAU,CAACF,CAAD,CAAiBQ,CAAY,EAA7B,CAAd,CAAgD,CAC5C,MACH,CAGDR,CAAc,CAAGQ,CAAY,EAA7B,CACA,GAAIK,CAAAA,CAAS,CAAGb,CAAhB,CAEAD,CAAiB,CAACe,SAAlB,CAA8B,EAA9B,CAT2C,GAUrCC,CAAAA,CAAW,CAAGxB,CAAW,CAACyB,6BAAZ,CAA0CjB,CAA1C,CAVuB,CAYrCkB,CAAO,CAAG,CACZC,UAAU,CAAE,6BADA,CAEZC,IAAI,CAAE,CACFC,IAAI,CAAEpB,CADJ,CAEFqB,IAAI,CAAEpB,CAFJ,CAFM,CAZ2B,CAoB3CT,CAAI,CAAC8B,IAAL,CAAU,CAACL,CAAD,CAAV,EAAqB,CAArB,EACKM,IADL,CACU,SAACC,CAAD,CAAc,CAChB,GAAItB,CAAU,CAACM,CAAY,EAAb,CAAiBK,CAAjB,CAAd,CAA2C,CACvCE,CAAW,CAACU,OAAZ,GAEA1B,CAAiB,CAACe,SAAlB,CAA8BU,CAAQ,CAACE,IAAvC,CAGAC,OAAO,CAACC,SAAR,CAAkB,IAAlB,CAAwB,IAAxB,CAA8B,IAAMJ,CAAQ,CAACK,GAA7C,CACH,CACJ,CAVL,EAWKC,IAXL,CAWUrC,CAAY,CAACsC,SAXvB,CAYH,CApEH,CAsEE,MAAO,CACHC,IAAI,CAAE,cAASC,CAAT,CAAsBZ,CAAtB,CAA4B,CAC9B1B,QAAQ,CAACC,cAAT,CAAwB,iBAAxB,EAA2CsC,KAA3C,CAAiDC,OAAjD,CAA2D,MAA3D,CAOAnC,CAAc,CAAGiC,CAAjB,CACAhC,CAAI,CAAGoB,CAAP,CAMAe,WAAW,CAACxB,CAAD,CAA8B,GAA9B,CACd,CAjBE,CAmBV,CAjGK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX reload of room plan on date change.\n *\n * @package    mod_room\n * @copyright  2020 Leo Auri <code@leoauri.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/*eslint no-trailing-spaces: \"warn\"*/\n/*eslint no-unused-vars: \"warn\"*/\n/*eslint no-console: \"warn\"*/\n\ndefine([\n    'core/loadingicon',\n    'core/ajax',\n    'core/notification',\n], function(\n    LoadingIcon,\n    Ajax,\n    Notification,\n) {\n    // const dateSelectEls = [\n    //     document.getElementById('id_displaydate_day'),\n    //     document.getElementById('id_displaydate_month'),\n    //     document.getElementById('id_displaydate_year')\n    // ];\n\n    const selectorDay = document.getElementById('id_displaydate_day');\n    const selectorMonth = document.getElementById('id_displaydate_month');\n    const selectorYear = document.getElementById('id_displaydate_year');\n\n    const roomPlanContainer = document.getElementById('mod-room-room-plan');\n\n    // let i = 0;\n    // const reloadRoomPlan = function() {\n    //     console.log(`it got triggered ${i++}`);\n    //     roomPlanContainer.innerHTML = '';\n    //     const loadingicon = LoadingIcon.addIconToContainerWithPromise(roomPlanContainer);\n\n    // };\n\n    let displayingDate;\n    let cmId;\n\n    const datesEqual = function(date1, date2) {\n        return date1.day === date2.day && date1.month === date2.month && date1.year === date2.year;\n    };\n\n    const selectedDate = function() {\n        return {\n            day: Math.floor(selectorDay.value),\n            month: Math.floor(selectorMonth.value),\n            year: Math.floor(selectorYear.value)\n        };\n    };\n\n    const reloadRoomPlanIfDateChanged = function() {\n        if (datesEqual(displayingDate, selectedDate())) {\n            return;\n        }\n\n        let wasDisplaying = displayingDate;\n        displayingDate = selectedDate();\n        let iWillLoad = displayingDate;\n\n        roomPlanContainer.innerHTML = '';\n        const loadingicon = LoadingIcon.addIconToContainerWithPromise(roomPlanContainer);\n\n        const request = {\n            methodname: 'mod_room_room_plan_rendered',\n            args: {\n                date: displayingDate,\n                cmid: cmId\n            }\n        };\n\n        Ajax.call([request])[0]\n            .then((response) => {\n                if (datesEqual(selectedDate(), iWillLoad)) {\n                    loadingicon.resolve();\n                    \n                    roomPlanContainer.innerHTML = response.html;\n                    \n                    // Push updated URL\n                    history.pushState(null, null, '?' + response.url);\n                }\n            })\n            .fail(Notification.exception);\n    };\n\n    return {\n        init: function(initialDate, cmid) {\n            document.getElementById('id_submitbutton').style.display = 'none';\n\n            // dateSelectEls.forEach((el) => {\n            //     el.addEventListener('input', reloadRoomPlan);\n            // });\n\n            // store initial date value\n            displayingDate = initialDate;\n            cmId = cmid;\n            // console.log(selectedDate());\n            // console.log(displayingDate);\n            // console.log(datesEqual(displayingDate, selectedDate()) ? 'equal' : 'not');\n\n            // poll for changed date fields\n            setInterval(reloadRoomPlanIfDateChanged, 250);\n        }\n    };\n});"],"file":"date_reload.min.js"}